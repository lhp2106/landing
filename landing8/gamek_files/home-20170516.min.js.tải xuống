function generateRandom(e,f){var b=[];while(b.length<=f){var d=Math.floor(Math.random()*(f-e+1))+e,c=false;for(var a=0;a<b.length;a++){if(b[a]==d){c=true;break}}if(!c){b[b.length]=d}}return b}var cosPlay={PageIndex:1,PageSize:24,page_count:0,like_count:24,flag:true,init:function(){var a=this;a.PageIndex=$("#hidPage").val();var c=$("#hidCurl").val();var d=$("#hidPurl").val();url="";var b=document.location.pathname.replace(/\/page-[0-9]+/,"");$(".menusub-cosplay li").removeClass("active");$('.menusub-cosplay li a[href="'+b+'"]').parent().addClass("active");if($(".pContent ul#tiles").length>0){$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>$(document).height()-1500){if(a.page_count<3){a.scroll(a.PageIndex)}else{$(window).off("scroll");$(".pContent").append('<div class="showmore">Xem tiếp</div>');$(".showmore").on("click",function(){if(c==d){url="/"+c+"/page-"+a.PageIndex+".chn"}else{url="/"+d+"/"+c+"/page-"+a.PageIndex+".chn"}window.location.href=url})}}});$("#tiles li").wookmark({autoResize:true,container:$("ul#tiles"),offset:20,itemWidth:312})}a.imageClick();a.embed();$('.cosplay-embed-header li:not(".last")').click(function(){if($(this).hasClass("active")){return}$(".cosplay-embed-header li").removeClass("active");$(this).addClass("active");a.embed()})},imageClick:function(){$(".photo-box .unlike > img, .cosplay-embed-content .unlike > img, .homecos_title .unlike > img").off("click").on("click",function(){var a=$(this);$.ajax({url:"/Handlers/LikeHandler.ashx",data:({command:"likephoto",id:a.attr("pid"),name:$("#hdLogin").val()}),success:function(b){if(b=="-2"){alert("Bạn đã thích bài này rồi!")}else{a.attr("src","/Images/like.png").off("click").parent().attr("class","like").find(">b").text(b).append("<i></i>");$(".home_cosplay_bottom li a.active").attr("c",b).attr("i","like")}}})})},scroll:function(a){var b=this;if(b.flag==false){return}b.flag=false;$.ajax({url:"/Ajax/Cosplay.aspx",data:({page:a,cat_id:$("#hdCatId").val(),type:$(".menusub-cosplay li.active a").attr("rel")}),dataType:"html",beforeSend:function(){$("#photo-loadding").show()},success:function(c){$("#photo-loadding").hide();if(c!=""){$("#tiles").append(c)}else{$(window).off("scroll");$(".showmore").remove()}b.page_count++;b.PageIndex++;b.flag=true;b.imageClick();b.applyLayout();for(var d=b.like_count;d<$(".photo-box").length;d++){FB.XFBML.parse($(".photo-box").get(d));b.like_count++}}})},applyLayout:function(){var a=$("#tiles li");a.wookmark({autoResize:true,container:$("ul#tiles"),offset:20,itemWidth:312})},embed:function(){var a=this;if($(".cosplay-embed").length>0){$.ajax({url:"/Handlers/LikeHandler.ashx",data:({command:"embed",type:$(".cosplay-embed-header li.active a").attr("rel")}),dataType:"json",beforeSend:function(){$(".cosplay-embed-content").html('<img src="/images/loader.gif" alt="" style="margin:75px 0 0 160px;" />')},success:function(b){var c="<ul>";var d=generateRandom(0,b.length-1);$.each(d,function(e,f){if($(".cosplay-embed-header li.active a").attr("rel")==1){f=e}c+="<li>";c+='<a href="'+b[f].url+'" title="'+b[f].title+'">';c+='<img width="96" height="144" src="'+b[f].src+'" alt="'+b[f].title+'" />';c+="</a>";if(b[f].action){c+='<span class="like">';c+='<img class="fl mgr10" pid="'+b[f].id+'" src="/images/like.png" alt="" />'}else{c+='<span class="unlike">';c+='<img class="fl mgr10" pid="'+b[f].id+'" src="/images/unlike.png" alt="" />'}c+="<b>"+b[f].likecount+"<i></i></b>";c+="</span>";c+="</li>"});c+="</ul>";c+='<img src="/images/btnPrev.png" alt="Prev" class="cosplay-prev" />';c+='<img src="/images/btnNext.png" alt="Prev" class="cosplay-next" />';c+='<a class="cosplay-readmore" href="/cosplay.chn">Xem tất cả...</a>';$(".cosplay-embed-content").html(c);$(".cosplay-embed-content ul").carouFredSel({prev:".cosplay-prev",next:".cosplay-next",auto:false,scroll:3});a.imageClick()}})}},home:function(){var a=this;if($(".home_cosplay_bottom ul").size()>0){$(".home_cosplay_bottom ul").carouFredSel({prev:".homecos_prev",next:".homecos_next",auto:false,scroll:4});$(".home_cosplay_bottom li:first a").addClass("active");$(".home_cosplay_bottom li a").on("click",function(d){d.preventDefault();if($(this).hasClass("active")){return}$(this).parent().parent().find("a").removeClass("active");$(this).addClass("active");var c=$(this).find(">img").attr("src").replace("zoom/72_72","thumb_w/330");$(".home_cosplay_center img.homecos_img").hide().load(function(){$(this).fadeIn()}).attr("src",c);$(".homecos_title > a").text($(this).attr("title")).attr("href",$(this).attr("href"));$(".homecos_title > span").attr("class",$(this).attr("i")).find(">img").attr("src","http://gamekcdn.com/images/"+$(this).attr("i")+".png").attr("pid",$(this).attr("rel")).next("b").html($(this).attr("c")+"<i></i>");$(".homecos_title #social_fb").remove();var b=String.format('<div id="social_fb" class="fb-like" data-href="{0}" data-send="false" data-layout="button_count" data-width="50" data-show-faces="false" data-font="arial"></div>',$(this).attr("s"));$(".homecos_title").append(b);a.imageClick()})}}};var newsLock={home:function(){$('.newsupdate>ul li.lock:not(".locked")').each(function(){if($(this).hasClass("locked")){return}var d=$(this).first();var b=d.next("li.lock");var f=b.next("li.lock");var c=f.next("li.lock").addClass("locks");if(b.length>0&&f.length>0&&c.length>0){d.addClass("locked");b.addClass("locked").css({"background-color":"#fff","border-color":"#fff"});f.addClass("locked");c.addClass("locked");var a=d.height()+b.outerHeight(true)+f.outerHeight(true);c.addClass("locks").css({position:"absolute",top:d.position().top,right:"0",height:a});var e=b.next().find("img").attr("src").replace(/\/zoom\/[0-9\_]+\//,"/zoom/220_305/");c.find("img").attr("src",e);c.find("p:first").show();c.find("p:first").trimLine(3)}else{d.css({background:"#d9f2e7",width:"100%"}).find("h3 a").css("color","#333").end().find("p").show();b.css({background:"#d9f2e7",width:"100%"}).find("h3 a").css("color","#333").end().find("p").show();f.css({background:"#d9f2e7",width:"100%"}).find("h3 a").css("color","#333").end().find("p").show()}})},relation:function(){$(".newsupdate>ul li.w455").each(function(){if($(this).hasClass("locked")){return}var f=$(this);var b=f.next(".w455");var j=b.next(".w455");if(f.length>0&&b.length>0&&j.length>0){f.addClass("locked");b.addClass("locked").css({"background-color":"#fff","border-color":"#fff"});j.addClass("locked");var d=f.prev("li");var a=f.height()+b.outerHeight(true)+j.outerHeight(true);d.addClass("locks").css({"float":"right",width:"220px",height:a});var i=d.find("img").attr("src").replace(/\/zoom\/[0-9\_]+\//,"/zoom/220_305/");d.find("img").attr("src",i);d.find("p:first").show();d.find("p:first").trimLine(3);d.find("p.time").remove();var e=f.find(">a").attr("href");$('.newsupdate >ul li:not(".locked, .locks") > a[href="'+e+'"]').parent().remove();var c=b.find(">a").attr("href");$('.newsupdate >ul li:not(".locked, .locks") > a[href="'+c+'"]').parent().remove();var g=j.find(">a").attr("href");$('.newsupdate >ul li:not(".locked, .locks") > a[href="'+g+'"]').parent().remove()}})}};var homeNews={pageIndex:1,flag:true,init:function(){hideText.home();var a=this;a.pageIndex=$("#PageIndex").val();if($(".newsupdate ul").length>0){$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>$(document).height()-1500){if(a.pageIndex%4==0){a.flag=false;$(".load_more").show();$(".per100 > img").remove()}else{a.bindData();$(".load_more").hide()}}})}$(".load_more").click(function(){a.flag=true;a.bindData();$(".load_more").hide()})},bindData:function(){var a=this;if(a.flag==false){return}a.flag=false;$.ajax({url:apiUrl+"/Ajax/DanhSachTin_Home.aspx",data:({Page:a.pageIndex,homeurl:$("#hdUrl").val(),listNewsId:$("#hfListNewsId").val()}),dataType:"html",beforeSend:function(){$(".per100").addClass("relative").append('<img style="position:absolute;left:38%;" src="http://gamekcdn.com/images/loading2.gif" alt="" />')},success:function(b){if(b.trim()!=""){$(b).appendTo(".newsupdate > ul");$(".newsupdate > ul li.fade-out").removeClass("fade-out");a.pageIndex++;a.flag=true;hideText.home();videoIframe.pushArrIframe(".newsupdate ul");$(".newsupdate >ul li.locks, .newsupdate >ul li.locked").each(function(){var c=$(this).find(">a").attr("href");$('.newsupdate >ul li:not(".locked, .locks") > a[href="'+c+'"]').parent().remove()})}else{$(".load_more").remove();$(".per100 > img").remove()}}})}};function fixHeight(){if(document.location.pathname=="/"||document.location.pathname=="/home.chn"||document.location.pathname=="/default.aspx"){var c=$(".homebox");if(c){for(var a=0;a<c.length;a++){if(c[a]&&c[a+1]){var b=Math.max($(c[a]).height(),$(c[a+1]).height());$(c[a]).height(b);$(c[a+1]).height(b);a++}}}}}function getViewAdtechBoxListGameVote(){var b=$(".tviewCrcIms");var a="";b.each(function(){a+=$(this).attr("data-crc")+","});a=a.trimEnd(",");$.ajax({url:"https://cmsanalytics.admicro.vn/cms/gamek.vn/item/report?news_ids=["+a+"]",dataType:"json",success:function(c){for(var d=0;d<c.length;d++){$(".tviewCrcIms[data-crc="+c[d].item_id+"]").html(c[d].total_view.view_pc+c[d].total_view.view_mob)}},error:function(){console.log("không lấy được view")}})}$(window).load(function(){cosPlay.home()});$(document).ready(function(){getViewAdtechBoxListGameVote();fixHeight()});